<!DOCTYPE html>
<html>

<head>
    <title>Medicines</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <!-- GLOBAL NAVBAR -->
    <nav class="top-nav">
        <div class="nav-left">
            <span class="brand">ClinicCare</span>
        </div>

        <div class="nav-right">
            <a href="dashboard.html">Dashboard</a>
            <a href="appointments.html">Appointments</a>
            <a href="medicines.html">Medicines</a>
            <a href="orders.html">Orders</a>
            <a href="profile.html">Profile</a>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </nav>

    <!-- PAGE CONTENT -->
    <main class="page-content">

        <h2>Medicines</h2>
        <p style="color:#6b7280; margin-bottom:24px;">
            Browse available medicines and add them to your cart.
        </p>

        <div id="medicineList" class="container">
            <!-- Medicines will load here -->
        </div>

    </main>

    <script>
        const token = localStorage.getItem("token");

        async function loadMedicines() {
            const response = await fetch("http://localhost:8080/medicines", {
                headers: {
                    "Authorization": "Bearer " + token
                }
            });

            const medicines = await response.json();
            const container = document.getElementById("medicineList");
            container.innerHTML = "";

            medicines.forEach(med => {
                const card = document.createElement("div");
                card.className = "card";

                card.innerHTML = `
            <h3>${med.name}</h3>
            <p><strong>Category:</strong> ${med.category || "General"}</p>
            <p><strong>Price:</strong> â‚¹${med.price}</p>
            <p><strong>Stock:</strong> ${med.stockQuantity}</p>
            <p>
                <strong>Prescription:</strong>
                ${med.prescriptionRequired ? "Required" : "Not Required"}
            </p>

        <button class="primary-btn" onclick='addToCart(${JSON.stringify(med)})'>
            Add to Cart
        </button>
        `;

                container.appendChild(card);
            });
        }

        function logout() {
            localStorage.removeItem("token");
            window.location.href = "index.html";
        }
        function getCart() {
            return JSON.parse(localStorage.getItem("cart")) || [];
        }

        function addToCart(med) {
            const cart = getCart();
            const existing = cart.find(item => item.id === med.id);

            if (existing) {
                existing.qty += 1;
            } else {
                cart.push({
                    id: med.id,
                    name: med.name,
                    price: med.price,
                    qty: 1
                });
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            alert("Added to cart");
        }
        loadMedicines();
    </script>

</body>

</html>