<!DOCTYPE html>
<html>

<head>
    <title>Medicines</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <!-- GLOBAL NAVBAR -->
    <nav class="top-nav">
        <div class="nav-left">
            <span class="brand">ClinicCare</span>
        </div>

    <div class="nav-right">
        <a href="dashboard.html">Dashboard</a>
        <a href="appointments.html">Appointments</a>
        <a href="book-appointment.html">Book</a>
        <a href="doctors.html">Doctors</a>
        <a href="medicines.html">Medicines</a>
        <a href="cart.html">Cart</a>
        <a href="orders.html">Orders</a>
        <a href="profile.html">Profile</a>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    </nav>

    <!-- PAGE CONTENT -->
    <main class="page-content">

        <h2>Medicines</h2>
        <p style="color:#6b7280; margin-bottom:24px;">
            Browse available medicines and add them to your cart.
        </p>

        <div id="medicineList" class="container">
            <!-- Medicines will load here -->
        </div>

    </main>

    <script>
        const token = localStorage.getItem("token");

        async function loadMedicines() {
            const response = await fetch("http://localhost:8080/medicines", {
                headers: {
                    "Authorization": "Bearer " + token
                }
            });

            const medicines = await response.json();
            const container = document.getElementById("medicineList");
            container.innerHTML = "";

            medicines.forEach(med => {
                const card = document.createElement("div");
                card.className = "card medicine-card";

                // Simple letter-based visual (no emojis/images)
                const visual = med.name.substring(0, 2).toUpperCase();

                let stockClass = "stock-ok";
                let stockText = "In stock";
                if (med.stockQuantity <= 10 && med.stockQuantity > 0) {
                    stockClass = "stock-low";
                    stockText = "Low stock";
                } else if (med.stockQuantity === 0) {
                    stockClass = "stock-out";
                    stockText = "Out of stock";
                }

                card.innerHTML = `
        <div class="medicine-media">${visual}</div>

        <h3 class="medicine-name">${med.name}</h3>

        <div class="medicine-meta">
            ${med.category || "General"} • 
            <span class="${stockClass}">${stockText}</span>
        </div>

        <div class="medicine-price">₹${med.price}</div>

        <div class="medicine-actions">
            <span class="badge ${med.prescriptionRequired ? "badge-warning" : "badge-success"}">
                ${med.prescriptionRequired ? "Prescription Required" : "OTC"}
            </span>

            <button class="primary-btn" onclick='addToCart(${JSON.stringify(med)})'>
                Add
            </button>
        </div>
    `;

                container.appendChild(card);
            });

        }
        function getCart() {
            return JSON.parse(localStorage.getItem("cart")) || [];
        }

        function addToCart(med) {
            const cart = getCart();
            const existing = cart.find(item => item.id === med.id);

            if (existing) {
                existing.qty += 1;
            } else {
                cart.push({
                    id: med.id,
                    name: med.name,
                    price: med.price,
                    qty: 1
                });
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            alert("Added to cart");
        }
        loadMedicines();
    </script>

</body>

</html>